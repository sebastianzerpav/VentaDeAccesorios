@page "/productos"
@layout MainLayout

@using Microsoft.AspNetCore.Components.Forms
@using System.IO

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">Productos</h3>
                    </div>

                    <EditForm Model="@producto" OnValidSubmit="HandleValidSubmit">
                        <div class="card-body">
                            <div class="card card-gray-dark">
                                <div class="card-header">
                                    <h3 class="card-title">Datos del Producto</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="id">ID</label>
                                                <InputNumber id="id" class="form-control" @bind-Value="producto.IdProducto" />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="nombre">Nombre</label>
                                                <InputText id="nombre" class="form-control" @bind-Value="producto.Nombre" />
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="descripcion">Descripción</label>
                                                <InputText id="descripcion" class="form-control" @bind-Value="producto.Descripcion" />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="precioCompra">Precio Compra</label>
                                                <InputNumber id="precioCompra" class="form-control" @bind-Value="producto.PrecioCompra" />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="precioVenta">Precio Venta</label>
                                                <InputNumber id="precioVenta" class="form-control" @bind-Value="producto.PrecioVenta" />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="stock">Stock</label>
                                                <InputNumber id="stock" class="form-control" @bind-Value="producto.StockTotal" />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="garantia">Garantía (meses)</label>
                                                <InputNumber id="garantia" class="form-control" @bind-Value="producto.GarantiaMeses" />
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="imagen">Imagen del producto</label>
                                                <InputFile OnChange="OnInputFileChange" class="form-control" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card card-danger mt-3">
                                <div class="card-header">
                                    <h3 class="card-title">PROCESO</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <button type="button" class="btn btn-primary btn-block btn-lg" @onclick="Insertar">INSERTAR</button>
                                        </div>
                                        <div class="col-md-3">
                                            <button type="button" class="btn btn-warning btn-block btn-lg" @onclick="Actualizar">ACTUALIZAR</button>
                                        </div>
                                        <div class="col-md-3">
                                            <button type="button" class="btn btn-danger btn-block btn-lg" @onclick="Eliminar">ELIMINAR</button>
                                        </div>
                                        <div class="col-md-3">
                                            <button type="button" class="btn btn-info btn-block btn-lg" @onclick="Consultar">CONSULTAR</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </EditForm>

                    <div class="card-footer">
                        <div id="dvMensaje">@mensaje</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@code {
    private Producto producto = new();
    private IBrowserFile? file;
    private string mensaje = "";

    private void HandleValidSubmit()
    {
        mensaje = "Formulario de producto válido.";
    }

    private void Insertar()
    {
        mensaje = "Insertar ejecutado.";

        if (file != null)
        {
            mensaje += " Imagen seleccionada: " + file.Name;
        }
    }

    private void Actualizar()
    {
        mensaje = "Actualizar ejecutado.";

        if (file != null)
        {
            mensaje += " Imagen seleccionada: " + file.Name;
        }
    }

    private void Eliminar()
    {
        mensaje = "Eliminar ejecutado.";
    }

    private void Consultar()
    {
        mensaje = "Consultar ejecutado.";
    }

    private void OnInputFileChange(InputFileChangeEventArgs e)
    {
        file = e.File;
    }

    public class Producto
    {
        public int IdProducto { get; set; }
        public string Nombre { get; set; } = string.Empty;
        public string Descripcion { get; set; } = string.Empty;
        public decimal PrecioCompra { get; set; }
        public decimal PrecioVenta { get; set; }
        public int StockTotal { get; set; }
        public int GarantiaMeses { get; set; }
    }
}